<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Тюнинг ВАЗ-2107 — Drag&amp;Drop + Монеты</title>
  <meta name="description" content="Перетаскивай цветные кубы на слоты, чтобы тюнинговать свою «семёрочку» и зарабатывать монеты." />
  <style>
    :root{
      --clr-red:#e74c3c; --clr-green:#27ae60; --clr-blue:#2980b9;
      --clr-yellow:#f1c40f; --clr-orange:#e67e22; --clr-purple:#8e44ad;
      --radius:.6rem; --shadow:0 2px 7px rgba(0,0,0,.15);
    }
    * {box-sizing:border-box}
    body{margin:0;font-family:system-ui,Arial;background:#808080;
         display:flex;flex-direction:column;align-items:center;min-height:100vh}
    nav{margin:1rem 0}
    nav a{margin:0 .75rem;color:#1c5980;font-weight:600;text-decoration:none}
    nav a:hover{text-decoration:underline}

    #coinsDisplay{font-weight:bold;font-size:18px;margin-bottom:20px;color:#fff}

    .main-grid{display:grid;gap:1.5rem;place-items:center;
               grid-template-areas:"left car right"
                                  "inv inv inv";
               max-width:900px;width:100%;padding:0 1rem}

    .slots{display:flex;flex-direction:column;gap:1rem}
    .slots--left{grid-area:left}.slots--right{grid-area:right}
    .car{grid-area:car}
    .inventory{grid-area:inv;display:grid;grid-template-columns:repeat(6,60px);gap:.75rem}

    .slot{width:60px;height:60px;border:2px dashed #666;border-radius:var(--radius);
          background:#f7f7f7;display:grid;place-content:center;position:relative}
    .slot:focus-visible{outline:3px solid #2980b9;outline-offset:2px}
    .slot.drag-over{border-color:#2980b9;background:#d0e7ff}
    .slot[data-filled=true]{border-style:solid}

    .cube{width:54px;height:54px;border-radius:var(--radius);
          cursor:grab;box-shadow:var(--shadow);transition:transform .15s}
    .cube:active{cursor:grabbing;transform:scale(1.1)}
    @media (prefers-reduced-motion:reduce){.cube{transition:none}}

    .red{background:var(--clr-red)}
    .green{background:var(--clr-green)}
    .blue{background:var(--clr-blue)}
    .yellow{background:var(--clr-yellow)}
    .orange{background:var(--clr-orange)}
    .purple{background:var(--clr-purple)}
  </style>
</head>
<body>

<nav>
  <a href="menu.html">Меню</a>
  <a href="race.html">Гонка</a>
  <a href="rating.html">Рейтинг</a>
  <a href="shop.html">Магазин</a>
</nav>

<div id="coinsDisplay">Монеты: 0</div>

<main class="main-grid">
  <section class="slots slots--left" aria-label="Левые цветовые слоты">
    <div class="slot" data-allowed="red" tabindex="0" title="Красный слот"></div>
    <div class="slot" data-allowed="green" tabindex="0" title="Зелёный слот"></div>
    <div class="slot" data-allowed="blue" tabindex="0" title="Синий слот"></div>
  </section>

  <figure class="car">
    <img src="https://astra-faq.ru/wp-content/uploads/2025/12/wx1-3207.png"
         alt="ВАЗ-2107" width="280" />
  </figure>

  <section class="slots slots--right" aria-label="Правые цветовые слоты">
    <div class="slot" data-allowed="yellow" tabindex="0" title="Жёлтый слот"></div>
    <div class="slot" data-allowed="orange" tabindex="0" title="Оранжевый слот"></div>
    <div class="slot" data-allowed="purple" tabindex="0" title="Фиолетовый слот"></div>
  </section>

  <section id="inventory" class="inventory" aria-label="Инвентарь кубов"></section>
</main>

<script>
  /*! ==========  МОНЕТЫ  ========== */
  const COINS_KEY = 'playerCoins';
  const coinsDisplay = document.getElementById('coinsDisplay');
  function getCoins() { return parseInt(localStorage.getItem(COINS_KEY)) || 0; }
  function setCoins(amount) { localStorage.setItem(COINS_KEY, amount); updateCoinsDisplay(); }
  function updateCoinsDisplay() { coinsDisplay.textContent = `Монеты: ${getCoins()}`; }
  function addCoins(amount) { setCoins(getCoins() + amount); }
  document.addEventListener('DOMContentLoaded', updateCoinsDisplay);

  /*! ==========  DRAG-DROP + ИГРА  ========== */
  const COLORS = ['red','green','blue','yellow','orange','purple'];
  const inventory = document.getElementById('inventory');
  let dragged = null;

  // создаём 30 ячеек инвентаря
  for (let i = 0; i < 30; i++) {
    const slot = Object.assign(document.createElement('div'), { className: 'slot', tabIndex: -1 });
    slot.dataset.pos = i;
    inventory.appendChild(slot);
  }
  // кладём по одному кубу
  COLORS.forEach((c, i) => inventory.children[i].appendChild(makeCube(c)));

  function makeCube(color) {
    const el = document.createElement('div');
    el.className = `cube ${color}`;
    el.draggable = true;
    el.dataset.color = color;
    el.title = `${color} куб`;
    return el;
  }

  // делегирование: один обработчик на document
  document.addEventListener('dragstart', e => {
    if (!e.target.classList.contains('cube')) return;
    dragged = e.target;
    e.dataTransfer.effectAllowed = 'move';
    requestAnimationFrame(() => dragged.style.visibility = 'hidden');
  }, { passive: true });

  document.addEventListener('dragend', () => {
    if (!dragged) return;
    dragged.style.visibility = '';
    dragged = null;
    document.querySelectorAll('.drag-over').forEach(s => s.classList.remove('drag-over'));
  });

  document.addEventListener('dragover', e => {
    const slot = e.target.closest('.slot');
    if (!slot || slot.dataset.filled === 'true') { e.dataTransfer.dropEffect = 'none'; return; }
    const need = slot.dataset.allowed, have = dragged.dataset.color;
    if (need && need !== have) { e.dataTransfer.dropEffect = 'none'; return; }
    slot.classList.add('drag-over');
    e.preventDefault(); // allow drop
  });

  document.addEventListener('dragleave', e => {
    e.target.closest('.slot')?.classList.remove('drag-over');
  });

  document.addEventListener('drop', e => {
    const slot = e.target.closest('.slot');
    if (!slot || slot.dataset.filled === 'true') return;
    const need = slot.dataset.allowed, have = dragged.dataset.color;
    if (need && need !== have) return;

    // перемещаем куб
    dragged.parentElement.dataset.filled = 'false';
    slot.appendChild(dragged);
    slot.dataset.filled = 'true';
    slot.classList.remove('drag-over');

    // НАГРАДА
    addCoins(0);
  });

  // клавиатурный drag-drop: Enter / Space
  document.addEventListener('keydown', e => {
    const cube = e.target.closest('.cube');
    if (!cube || !(e.key === 'Enter' || e.key === ' ')) return;
    e.preventDefault();
    const emptySlot = [...document.querySelectorAll('.slot')]
      .find(s => s.dataset.filled !== 'true' &&
            (!s.dataset.allowed || s.dataset.allowed === cube.dataset.color));
    if (emptySlot) {
      cube.parentElement.dataset.filled = 'false';
      emptySlot.appendChild(cube);
      emptySlot.dataset.filled = 'true';
      addCoins(10);
    }
  });
</script>

</body>
</html>
