<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üèÅ –ö–ò–†–Æ–•–ê RACING ‚Äî –ù–û–ß–ù–ê–Ø –ì–û–ù–ö–ê</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      min-height: 100vh;
      background: #0a0a0f;
      position: relative;
      overflow-x: hidden;
    }

    /* ========== –ê–ù–ò–ú–ò–†–û–í–ê–ù–ù–´–ô –§–û–ù –° –ù–ï–û–ù–û–ú ========== */
    .cyber-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    .cyber-grid {
      position: absolute;
      width: 200%;
      height: 200%;
      background-image: 
        linear-gradient(rgba(0, 255, 255, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 0, 255, 0.05) 1px, transparent 1px);
      background-size: 50px 50px;
      transform: perspective(500px) rotateX(60deg);
      animation: gridMove 20s linear infinite;
      top: -50%;
      left: -50%;
    }

    @keyframes gridMove {
      0% { transform: perspective(500px) rotateX(60deg) translateY(0); }
      100% { transform: perspective(500px) rotateX(60deg) translateY(50px); }
    }

    .cyber-lights {
      position: absolute;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 30% 50%, rgba(255, 0, 255, 0.2) 0%, transparent 50%),
                  radial-gradient(circle at 70% 50%, rgba(0, 255, 255, 0.2) 0%, transparent 50%);
      animation: lightsPulse 4s ease-in-out infinite;
    }

    @keyframes lightsPulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    /* ========== –ù–ê–í–ò–ì–ê–¶–ò–Ø ========== */
    .cyber-nav {
      position: relative;
      z-index: 10;
      display: flex;
      justify-content: center;
      gap: 20px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      border-bottom: 2px solid rgba(0, 255, 255, 0.3);
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.2);
    }

    .cyber-nav a {
      color: #fff;
      text-decoration: none;
      font-weight: bold;
      padding: 10px 25px;
      border-radius: 30px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(0, 255, 255, 0.3);
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 2px;
      font-size: 14px;
      position: relative;
      overflow: hidden;
    }

    .cyber-nav a::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.4), transparent);
      transition: left 0.5s;
    }

    .cyber-nav a:hover {
      background: rgba(0, 255, 255, 0.2);
      border-color: #0ff;
      box-shadow: 0 0 20px #0ff;
      transform: translateY(-2px);
    }

    .cyber-nav a:hover::before {
      left: 100%;
    }

    /* ========== –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† ========== */
    .race-container {
      max-width: 1200px;
      margin: 30px auto;
      padding: 20px;
      position: relative;
      z-index: 5;
    }

    /* ========== –ó–ê–ì–û–õ–û–í–û–ö –° –ù–ï–û–ù–û–ú ========== */
    .cyber-title {
      text-align: center;
      margin-bottom: 40px;
      position: relative;
    }

    .cyber-title h1 {
      font-size: 64px;
      font-weight: 900;
      text-transform: uppercase;
      color: transparent;
      -webkit-text-stroke: 2px #0ff;
      text-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
      letter-spacing: 8px;
      animation: titleFlicker 3s infinite;
    }

    .cyber-title h1::before,
    .cyber-title h1::after {
      content: 'üèÅ';
      position: absolute;
      font-size: 40px;
      filter: drop-shadow(0 0 10px #f0f);
    }

    .cyber-title h1::before {
      left: 20%;
      top: -20px;
      animation: flagMove 2s infinite;
    }

    .cyber-title h1::after {
      right: 20%;
      bottom: -20px;
      animation: flagMove 2s infinite reverse;
    }

    @keyframes titleFlicker {
      0%, 100% { opacity: 1; }
      95% { opacity: 1; }
      96% { opacity: 0.5; }
      97% { opacity: 1; }
      98% { opacity: 0.3; }
      99% { opacity: 1; }
    }

    @keyframes flagMove {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(10px) rotate(10deg); }
    }

    /* ========== –ë–õ–û–ö –ú–û–ù–ï–¢ ========== */
    .coins-panel {
      background: linear-gradient(135deg, #000, #1a0033);
      border: 2px solid #f0f;
      border-radius: 50px;
      padding: 15px 40px;
      margin: 0 auto 30px;
      width: fit-content;
      position: relative;
      box-shadow: 0 0 50px rgba(255, 0, 255, 0.5);
      animation: coinsPulse 2s infinite;
    }

    @keyframes coinsPulse {
      0%, 100% { box-shadow: 0 0 50px rgba(255, 0, 255, 0.5); }
      50% { box-shadow: 0 0 80px rgba(0, 255, 255, 0.5); }
    }

    .coins-panel span {
      font-size: 32px;
      font-weight: bold;
      background: linear-gradient(45deg, #f0f, #0ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* ========== –¢–†–ê–°–°–´ ========== */
    .tracks-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 30px;
      margin-bottom: 40px;
    }

    .track-card {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      border: 2px solid;
      border-radius: 30px;
      padding: 30px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.4s;
      position: relative;
      overflow: hidden;
    }

    .track-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transform: rotate(45deg);
      animation: cardShine 6s infinite;
    }

    @keyframes cardShine {
      0% { transform: translateX(-100%) rotate(45deg); }
      20% { transform: translateX(100%) rotate(45deg); }
      100% { transform: translateX(100%) rotate(45deg); }
    }

    .track-card:hover {
      transform: translateY(-10px) scale(1.05);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
    }

    .track-card.city {
      border-color: #0ff;
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
    }

    .track-card.mountain {
      border-color: #0f0;
      box-shadow: 0 0 30px rgba(0, 255, 0, 0.3);
    }

    .track-card.night {
      border-color: #f0f;
      box-shadow: 0 0 30px rgba(255, 0, 255, 0.3);
    }

    .track-emoji {
      font-size: 80px;
      margin-bottom: 15px;
      filter: drop-shadow(0 0 20px currentColor);
      animation: emojiFloat 3s infinite;
    }

    @keyframes emojiFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .track-card h2 {
      color: #fff;
      font-size: 28px;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .track-difficulty {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin: 15px 0;
    }

    .difficulty-dot {
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
    }

    .difficulty-dot.active {
      background: #0ff;
      box-shadow: 0 0 10px #0ff;
    }

    .track-reward {
      font-size: 24px;
      font-weight: bold;
      background: linear-gradient(45deg, #f0f, #0ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 15px 0;
    }

    .track-btn {
      background: transparent;
      border: 2px solid;
      color: #fff;
      padding: 12px 30px;
      border-radius: 30px;
      font-weight: bold;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-top: 15px;
    }

    .track-card.city .track-btn { border-color: #0ff; }
    .track-card.mountain .track-btn { border-color: #0f0; }
    .track-card.night .track-btn { border-color: #f0f; }

    .track-btn:hover {
      background: currentColor;
      color: #000;
      box-shadow: 0 0 30px currentColor;
    }

    /* ========== –ì–û–ù–û–ß–ù–ê–Ø –ê–†–ï–ù–ê ========== */
    .race-arena {
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      border: 2px solid #0ff;
      border-radius: 50px;
      padding: 30px;
      margin-top: 40px;
      box-shadow: 0 0 50px rgba(0, 255, 255, 0.3);
      position: relative;
      overflow: hidden;
    }

    .race-arena::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.2), transparent);
      animation: scanline 3s linear infinite;
    }

    @keyframes scanline {
      0% { left: -100%; }
      100% { left: 200%; }
    }

    .race-status {
      text-align: center;
      font-size: 24px;
      color: #0ff;
      margin-bottom: 30px;
      text-transform: uppercase;
      letter-spacing: 4px;
      text-shadow: 0 0 20px #0ff;
      animation: statusBlink 1.5s infinite;
    }

    @keyframes statusBlink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* ========== –ì–û–ù–û–ß–ù–ê–Ø –ü–û–õ–û–°–ê ========== */
    .race-track {
      width: 100%;
      height: 200px;
      background: linear-gradient(90deg, #1a1a2e, #16213e);
      border-radius: 20px;
      position: relative;
      overflow: hidden;
      margin-bottom: 30px;
    }

    .track-lines {
      position: absolute;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(90deg, 
        transparent,
        transparent 50px,
        rgba(255, 255, 255, 0.1) 50px,
        rgba(255, 255, 255, 0.1) 100px
      );
      animation: trackMove 1s linear infinite;
    }

    @keyframes trackMove {
      0% { background-position: 0 0; }
      100% { background-position: 100px 0; }
    }

    .car-container {
      position: absolute;
      bottom: 20px;
      left: 20px;
      transition: left 0.1s linear;
      filter: drop-shadow(0 0 20px #0ff);
      animation: carShake 0.2s infinite;
    }

    @keyframes carShake {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-2px); }
    }

    .car-container svg {
      width: 80px;
      height: auto;
    }

    .finish-line {
      position: absolute;
      right: 0;
      top: 0;
      width: 20px;
      height: 100%;
      background: repeating-linear-gradient(45deg, #fff, #fff 20px, #000 20px, #000 40px);
      animation: finishGlow 1s infinite;
    }

    @keyframes finishGlow {
      0%, 100% { box-shadow: 0 0 20px #fff; }
      50% { box-shadow: 0 0 40px #ff0; }
    }

    .nitro-effect {
      position: absolute;
      right: -30px;
      bottom: 15px;
      width: 50px;
      height: 30px;
      background: linear-gradient(90deg, #ff0, #f0f, #0ff);
      filter: blur(10px);
      animation: nitroFire 0.2s infinite;
    }

    @keyframes nitroFire {
      0%, 100% { opacity: 0.8; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.2); }
    }

    /* ========== –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ì–û–ù–ö–ï ========== */
    .race-info {
      display: flex;
      justify-content: space-around;
      color: #fff;
      font-size: 20px;
      margin: 20px 0;
    }

    .info-item {
      text-align: center;
      padding: 15px 30px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      border: 1px solid rgba(0, 255, 255, 0.3);
    }

    .info-label {
      color: #0ff;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .info-value {
      font-size: 32px;
      font-weight: bold;
      background: linear-gradient(45deg, #f0f, #0ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* ========== –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø ========== */
    .race-controls {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 30px 0;
    }

    .race-control-btn {
      background: transparent;
      border: 2px solid;
      color: #fff;
      padding: 15px 40px;
      border-radius: 40px;
      font-weight: bold;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 2px;
      position: relative;
      overflow: hidden;
    }

    .race-control-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.3s;
    }

    .race-control-btn:hover::before {
      left: 100%;
    }

    .race-control-btn.start {
      border-color: #0f0;
      box-shadow: 0 0 30px rgba(0, 255, 0, 0.3);
    }

    .race-control-btn.start:hover {
      background: #0f0;
      color: #000;
      box-shadow: 0 0 50px #0f0;
    }

    .race-control-btn.nitro {
      border-color: #f0f;
      box-shadow: 0 0 30px rgba(255, 0, 255, 0.3);
    }

    .race-control-btn.nitro:hover:not(:disabled) {
      background: #f0f;
      color: #000;
      box-shadow: 0 0 50px #f0f;
    }

    .race-control-btn.nitro:disabled {
      opacity: 0.3;
      cursor: not-allowed;
      border-color: #666;
    }

    /* ========== –†–ï–ó–£–õ–¨–¢–ê–¢–´ ========== */
    .race-result {
      text-align: center;
      padding: 30px;
      background: rgba(0, 0, 0, 0.9);
      border-radius: 30px;
      margin-top: 20px;
      border: 2px solid;
      animation: resultPop 0.5s;
    }

    @keyframes resultPop {
      0% { transform: scale(0); }
      80% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    .result-win {
      border-color: #0f0;
      box-shadow: 0 0 50px #0f0;
    }

    .result-lose {
      border-color: #f00;
      box-shadow: 0 0 50px #f00;
    }

    .result-title {
      font-size: 48px;
      font-weight: bold;
      margin-bottom: 20px;
      text-transform: uppercase;
    }

    .result-win .result-title {
      color: #0f0;
      text-shadow: 0 0 30px #0f0;
    }

    .result-lose .result-title {
      color: #f00;
      text-shadow: 0 0 30px #f00;
    }

    .result-reward {
      font-size: 36px;
      background: linear-gradient(45deg, #f0f, #0ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* ========== –ê–ù–ò–ú–ê–¶–ò–ò ========== */
    .speed-particles {
      position: absolute;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #0ff;
      border-radius: 50%;
      animation: particleFly 1s linear infinite;
    }

    @keyframes particleFly {
      0% { transform: translateX(0) translateY(0); opacity: 1; }
      100% { transform: translateX(-100px) translateY(20px); opacity: 0; }
    }

    /* ========== –ö–ù–û–ü–ö–ê –ù–ê–ó–ê–î ========== */
    .back-btn {
      position: fixed;
      bottom: 30px;
      left: 30px;
      background: transparent;
      border: 2px solid #0ff;
      color: #0ff;
      padding: 12px 30px;
      border-radius: 40px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      z-index: 100;
      text-transform: uppercase;
      letter-spacing: 2px;
      backdrop-filter: blur(10px);
    }

    .back-btn:hover {
      background: #0ff;
      color: #000;
      box-shadow: 0 0 50px #0ff;
      transform: scale(1.1);
    }
  </style>
</head>
<body>
  <div class="cyber-background">
    <div class="cyber-grid"></div>
    <div class="cyber-lights"></div>
  </div>

  <nav class="cyber-nav">
    <a href="menu.html">–ú–ï–ù–Æ</a>
    <a href="garage.html">–ì–ê–†–ê–ñ</a>
    <a href="rating.html">–†–ï–ô–¢–ò–ù–ì</a>
    <a href="shop.html">–ú–ê–ì–ê–ó–ò–ù</a>
  </nav>

  <div class="race-container">
    <div class="cyber-title">
      <h1>–ù–û–ß–ù–ê–Ø –ì–û–ù–ö–ê</h1>
    </div>

    <div class="coins-panel">
      <span id="coinsDisplay">1000</span> –ú–û–ù–ï–¢
    </div>

    <div class="tracks-grid">
      <!-- –ì–æ—Ä–æ–¥—Å–∫–∞—è —Ç—Ä–∞—Å—Å–∞ -->
      <div class="track-card city" onclick="selectTrack('city')">
        <div class="track-emoji">üèôÔ∏è</div>
        <h2>CITY RUSH</h2>
        <div class="track-difficulty">
          <span class="difficulty-dot active"></span>
          <span class="difficulty-dot"></span>
          <span class="difficulty-dot"></span>
        </div>
        <div class="track-reward">+100 –º–æ–Ω–µ—Ç</div>
        <button class="track-btn">–í–´–ë–†–ê–¢–¨</button>
      </div>

      <!-- –ì–æ—Ä–Ω–∞—è —Ç—Ä–∞—Å—Å–∞ -->
      <div class="track-card mountain" onclick="selectTrack('mountain')">
        <div class="track-emoji">‚õ∞Ô∏è</div>
        <h2>MOUNTAIN</h2>
        <div class="track-difficulty">
          <span class="difficulty-dot active"></span>
          <span class="difficulty-dot active"></span>
          <span class="difficulty-dot"></span>
        </div>
        <div class="track-reward">+200 –º–æ–Ω–µ—Ç</div>
        <button class="track-btn">–í–´–ë–†–ê–¢–¨</button>
      </div>

      <!-- –ù–æ—á–Ω–∞—è —Ç—Ä–∞—Å—Å–∞ -->
      <div class="track-card night" onclick="selectTrack('night')">
        <div class="track-emoji">üåÉ</div>
        <h2>NIGHT RACE</h2>
        <div class="track-difficulty">
          <span class="difficulty-dot active"></span>
          <span class="difficulty-dot active"></span>
          <span class="difficulty-dot active"></span>
        </div>
        <div class="track-reward">+300 –º–æ–Ω–µ—Ç</div>
        <button class="track-btn">–í–´–ë–†–ê–¢–¨</button>
      </div>
    </div>

    <div class="race-arena" id="raceArena">
      <div class="race-status" id="raceStatus">–í–´–ë–ï–†–ò –¢–†–ê–°–°–£</div>
      
      <div class="race-track" id="raceTrack">
        <div class="track-lines"></div>
        <div class="car-container" id="car" style="left: 20px;">
          <svg viewBox="0 0 100 40">
            <rect x="20" y="10" width="60" height="20" rx="8" fill="#ff0000" filter="url(#glow)"/>
            <circle cx="35" cy="30" r="6" fill="#333"/>
            <circle cx="65" cy="30" r="6" fill="#333"/>
            <rect x="25" y="5" width="10" height="8" fill="#0ff"/>
            <rect x="45" y="5" width="10" height="8" fill="#0ff"/>
            <defs>
              <filter id="glow">
                <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                <feMerge>
                  <feMergeNode in="coloredBlur"/>
                  <feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>
            </defs>
          </svg>
          <div class="nitro-effect" id="nitroEffect" style="display: none;"></div>
        </div>
        <div class="finish-line"></div>
        
        <!-- –ß–∞—Å—Ç–∏—Ü—ã —Å–∫–æ—Ä–æ—Å—Ç–∏ -->
        <div class="speed-particles" id="particles"></div>
      </div>

      <div class="race-info">
        <div class="info-item">
          <div class="info-label">–¢–†–ê–°–°–ê</div>
          <div class="info-value" id="trackName">‚Äî</div>
        </div>
        <div class="info-item">
          <div class="info-label">–°–ö–û–†–û–°–¢–¨</div>
          <div class="info-value" id="speed">0</div>
        </div>
        <div class="info-item">
          <div class="info-label">–ü–†–û–ì–†–ï–°–°</div>
          <div class="info-value" id="progress">0%</div>
        </div>
      </div>

      <div class="race-controls">
        <button class="race-control-btn start" id="startRaceBtn" onclick="startRace()">üèÅ –°–¢–ê–†–¢</button>
        <button class="race-control-btn nitro" id="nitroBtn" onclick="useNitro()" disabled>‚ö° NITRO</button>
      </div>

      <div id="raceResult" style="display: none;"></div>
    </div>
  </div>

  <button class="back-btn" onclick="window.location.href='menu.html'">‚Üê –ù–ê–ó–ê–î</button>

  <script>
    // ========== –ú–û–ù–ï–¢–´ ==========
    const COINS_KEY = 'playerCoins';
    
    function getCoins() { 
      return parseInt(localStorage.getItem(COINS_KEY)) || 1000; 
    }
    
    function setCoins(amount) { 
      localStorage.setItem(COINS_KEY, amount); 
      updateCoinsDisplay(); 
    }
    
    function updateCoinsDisplay() { 
      document.getElementById('coinsDisplay').textContent = getCoins(); 
    }
    
    function addCoins(amount) { 
      setCoins(getCoins() + amount); 
    }

    // ========== –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ì–û–ù–ö–ò ==========
    let currentTrack = null;
    let raceInterval = null;
    let carPosition = 20;
    let speed = 0;
    let nitroCharges = 3;
    let raceActive = false;
    let particlesInterval = null;

    const tracks = {
      city: {
        name: 'CITY RUSH',
        difficulty: 1,
        reward: 100,
        maxSpeed: 100,
        color: '#0ff'
      },
      mountain: {
        name: 'MOUNTAIN',
        difficulty: 2,
        reward: 200,
        maxSpeed: 80,
        color: '#0f0'
      },
      night: {
        name: 'NIGHT RACE',
        difficulty: 3,
        reward: 300,
        maxSpeed: 60,
        color: '#f0f'
      }
    };

    // ========== –í–´–ë–û–† –¢–†–ê–°–°–´ ==========
    function selectTrack(trackId) {
      if (raceActive) return;
      
      currentTrack = tracks[trackId];
      document.getElementById('trackName').textContent = currentTrack.name;
      document.getElementById('raceStatus').textContent = `–ì–û–¢–û–í –ö –ì–û–ù–ö–ï: ${currentTrack.name}`;
      document.getElementById('startRaceBtn').disabled = false;
      
      // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç—Ä–∞—Å—Å—ã
      document.querySelectorAll('.track-card').forEach(card => {
        card.style.transform = 'scale(1)';
      });
      event.currentTarget.style.transform = 'scale(1.05)';
    }

    // ========== –ù–ê–ß–ê–õ–û –ì–û–ù–ö–ò ==========
    function startRace() {
      if (!currentTrack || raceActive) return;
      
      raceActive = true;
      carPosition = 20;
      speed = 0;
      nitroCharges = 3;
      document.getElementById('nitroBtn').disabled = false;
      document.getElementById('startRaceBtn').disabled = true;
      document.getElementById('raceResult').style.display = 'none';
      
      document.getElementById('raceStatus').textContent = '–ì–û–ù–ö–ê –ù–ê–ß–ê–õ–ê–°–¨! üí®';
      
      // –°–æ–∑–¥–∞–µ–º —á–∞—Å—Ç–∏—Ü—ã
      startParticles();
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º –≥–æ–Ω–∫—É
      raceInterval = setInterval(() => {
        if (!raceActive) return;
        
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å
        speed = Math.min(speed + (Math.random() * 3), currentTrack.maxSpeed);
        
        // –î–≤–∏–≥–∞–µ–º –º–∞—à–∏–Ω—É
        carPosition += speed / 20;
        document.getElementById('car').style.left = carPosition + 'px';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        document.getElementById('speed').textContent = Math.floor(speed);
        const progress = Math.min(Math.floor((carPosition / 500) * 100), 100);
        document.getElementById('progress').textContent = progress + '%';
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∏–Ω–∏—à
        if (carPosition >= 500) {
          finishRace(true);
        }
        
        // –°–ª—É—á–∞–π–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ (–ø–æ–ª–æ–º–∫–∞)
        if (Math.random() < 0.01 && speed > 30) {
          speed = 0;
          document.getElementById('raceStatus').textContent = '–ü–û–õ–û–ú–ö–ê! üõ†Ô∏è';
          setTimeout(() => {
            document.getElementById('raceStatus').textContent = '–ì–û–ù–ö–ê –ü–†–û–î–û–õ–ñ–ê–ï–¢–°–Ø!';
          }, 1000);
        }
      }, 100);
    }

    // ========== –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï NITRO ==========
    function useNitro() {
      if (!raceActive || nitroCharges <= 0) return;
      
      nitroCharges--;
      if (nitroCharges <= 0) {
        document.getElementById('nitroBtn').disabled = true;
      }
      
      // –≠—Ñ—Ñ–µ–∫—Ç –Ω–∏—Ç—Ä–æ
      speed = Math.min(speed + 30, currentTrack.maxSpeed + 20);
      document.getElementById('nitroEffect').style.display = 'block';
      
      // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
      document.getElementById('raceStatus').textContent = '‚ö° NITRO –ê–ö–¢–ò–í–ò–†–û–í–ê–ù! ‚ö°';
      
      setTimeout(() => {
        document.getElementById('nitroEffect').style.display = 'none';
        document.getElementById('raceStatus').textContent = '–ì–û–ù–ö–ê –ü–†–û–î–û–õ–ñ–ê–ï–¢–°–Ø!';
      }, 1000);
      
      // –¢—Ä—è—Å–∫–∞ —ç–∫—Ä–∞–Ω–∞
      document.querySelector('.race-arena').style.transform = 'translateX(5px)';
      setTimeout(() => {
        document.querySelector('.race-arena').style.transform = 'translateX(-5px)';
      }, 50);
      setTimeout(() => {
        document.querySelector('.race-arena').style.transform = 'translateX(0)';
      }, 100);
    }

    // ========== –ó–ê–í–ï–†–®–ï–ù–ò–ï –ì–û–ù–ö–ò ==========
    function finishRace(win) {
      raceActive = false;
      clearInterval(raceInterval);
      stopParticles();
      
      const resultDiv = document.getElementById('raceResult');
      resultDiv.style.display = 'block';
      
      if (win) {
        // –†–∞—Å—á–µ—Ç –Ω–∞–≥—Ä–∞–¥—ã
        let reward = currentTrack.reward;
        if (speed > currentTrack.maxSpeed * 0.8) {
          reward = Math.floor(reward * 1.5); // –ë–æ–Ω—É—Å –∑–∞ —Å–∫–æ—Ä–æ—Å—Ç—å
        }
        
        addCoins(reward);
        
        resultDiv.className = 'race-result result-win';
        resultDiv.innerHTML = `
          <div class="result-title">üèÜ –ü–û–ë–ï–î–ê üèÜ</div>
          <div class="result-reward">+${reward} –ú–û–ù–ï–¢</div>
          <div style="color: #fff; margin-top: 20px;">–ú–∞–∫—Å. —Å–∫–æ—Ä–æ—Å—Ç—å: ${Math.floor(speed)} –∫–º/—á</div>
        `;
        
        document.getElementById('raceStatus').textContent = '–¢–´ –ü–û–ë–ï–î–ò–õ! üéâ';
      } else {
        resultDiv.className = 'race-result result-lose';
        resultDiv.innerHTML = `
          <div class="result-title">üò¢ –ü–û–†–ê–ñ–ï–ù–ò–ï</div>
          <div style="color: #fff; margin-top: 20px;">–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!</div>
        `;
        
        document.getElementById('raceStatus').textContent = '–ü–û–ü–†–û–ë–£–ô –°–ù–û–í–ê...';
      }
      
      document.getElementById('startRaceBtn').disabled = false;
    }

    // ========== –ß–ê–°–¢–ò–¶–´ –°–ö–û–†–û–°–¢–ò ==========
    function startParticles() {
      const particlesContainer = document.getElementById('particles');
      
      particlesInterval = setInterval(() => {
        if (!raceActive) return;
        
        for (let i = 0; i < 3; i++) {
          const particle = document.createElement('div');
          particle.className = 'particle';
          particle.style.left = '480px';
          particle.style.top = Math.random() * 200 + 'px';
          particle.style.background = currentTrack ? currentTrack.color : '#0ff';
          particlesContainer.appendChild(particle);
          
          setTimeout(() => {
            particle.remove();
          }, 1000);
        }
      }, 100);
    }

    function stopParticles() {
      clearInterval(particlesInterval);
      document.getElementById('particles').innerHTML = '';
    }

    // ========== –°–ë–†–û–° –ì–û–ù–ö–ò ==========
    function resetRace() {
      raceActive = false;
      clearInterval(raceInterval);
      stopParticles();
      
      carPosition = 20;
      speed = 0;
      document.getElementById('car').style.left = '20px';
      document.getElementById('speed').textContent = '0';
